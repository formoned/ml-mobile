"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var dialogs_1 = require("tns-core-modules/ui/dialogs");
var nativescript_angular_1 = require("nativescript-angular");
var router_1 = require("@angular/router");
var services_1 = require("../../../core/services");
var nativescript_google_maps_sdk_1 = require("nativescript-google-maps-sdk");
var enums_1 = require("tns-core-modules/ui/enums");
var nativescript_geolocation_1 = require("nativescript-geolocation");
var PostEditComponent = /** @class */ (function () {
    function PostEditComponent(routerExtensions, route, apiPostService, apiGetService, router) {
        this.routerExtensions = routerExtensions;
        this.route = route;
        this.apiPostService = apiPostService;
        this.apiGetService = apiGetService;
        this.router = router;
        this.buttonText = "Start location monitoring";
        this.isMonitoring = false;
        this.monitorLongitude = "0";
        this.monitorLatitude = "0";
        this.monitorAltitude = "0";
        this.monitorDirection = "0";
        this.monitorSpeed = "0";
        this.zoom = 12;
        this.minZoom = 0;
        this.maxZoom = 22;
        this.bearing = 0;
        this.tilt = 0;
        this.padding = [40, 40, 40, 40];
        this.loadData = false;
        this.isSubmiting = false;
        this.options = {
            desiredAccuracy: enums_1.Accuracy.high,
            updateDistance: 0.1,
            updateTime: 3000,
            minimumUpdateTime: 100
        };
        nativescript_geolocation_1.enableLocationRequest(true);
        this.post = {
            id: null,
            title: '',
            description: '',
            lat: 0,
            lng: 0
        };
        this.postData = {
            id: null,
            title: '',
            description: '',
            lat: null,
            lng: null,
            map_lat: null,
            map_lng: null,
            created_by: null,
            created_at: '',
            updated_at: '',
            editable: false,
            form: this.post
        };
    }
    PostEditComponent.prototype.ngOnInit = function () {
        this.id = this.route.snapshot.params['id'];
        // this.returnUrl = this.route.snapshot.queryParams['returnUrl'];
    };
    PostEditComponent.prototype.loadPost = function (_id) {
        var _this = this;
        this.loadData = true;
        this.apiGetService.getUserPost(_id)
            .subscribe(function (response) {
            if (response.success == true) {
                var post = response.posts;
                _this.postData.id = post.id;
                _this.postData.title = post.title;
                _this.postData.description = post.description;
                _this.postData.lat = post.lat;
                _this.postData.lng = post.lng;
                _this.postData.map_lat = post.lat;
                _this.postData.map_lng = post.lng;
                _this.postData.created_by = post.created_by;
                _this.postData.created_at = post.created_at;
                _this.postData.updated_at = post.updated_at;
                _this.postData.editable = false;
                // /
                _this.post.id = post.id;
                _this.post.title = post.title;
                _this.post.description = post.description;
                _this.post.lat = post.lat;
                _this.post.lng = post.lng;
                var marker = new nativescript_google_maps_sdk_1.Marker();
                marker.position = nativescript_google_maps_sdk_1.Position.positionFromLatLng(_this.post.lat, _this.post.lng);
                // marker.title = this.post.title;
                marker.userData = _this.postData;
                _this.mapView.addMarker(marker);
                _this.mapView.latitude = +_this.post.lat;
                _this.mapView.longitude = +_this.post.lng;
                _this.mapView.zoom = 15;
                _this.mapView.updateCamera();
                _this.mapView.updatePadding();
            }
            _this.loadData = false;
        }, function (error) {
            dialogs_1.alert((JSON.parse(error.text())).message);
            console.log(error.text());
        });
    };
    //Map events
    PostEditComponent.prototype.onMapReady = function (event) {
        console.log('Map Ready');
        this.mapView = event.object;
        var gMap = event.gMap;
        // gMap.setMyLocationEnabled(true);
        this.mapView.myLocationEnabled = true;
        this.loadPost(this.id);
        // this.monitor();
    };
    PostEditComponent.prototype.monitor = function (args) {
        var _this = this;
        // >> location-monitoring
        if (this.isMonitoring) {
            nativescript_geolocation_1.clearWatch(this.listener);
            this.isMonitoring = false;
            this.buttonText = "Start location monitoring";
        }
        else {
            this.listener = nativescript_geolocation_1.watchLocation(function (loc) {
                if (loc) {
                    _this.monitorLongitude = (loc.longitude).toFixed(4);
                    _this.monitorLatitude = (loc.latitude).toFixed(4);
                    _this.monitorAltitude = (loc.altitude).toFixed(2);
                    _this.monitorDirection = (loc.direction).toFixed(2);
                    _this.monitorSpeed = (loc.speed).toFixed(2);
                }
            }, function (e) {
                console.log("Error: " + e.message);
            }, this.options);
            this.isMonitoring = true;
            this.buttonText = "Stop location monitoring";
        }
        // << location-monitoring
    };
    PostEditComponent.prototype.onCoordinateTapped = function (args) {
        if (this.postData.editable) {
            this.mapView.removeAllMarkers();
            var marker = new nativescript_google_maps_sdk_1.Marker();
            marker.position = nativescript_google_maps_sdk_1.Position.positionFromLatLng(args.position.latitude, args.position.longitude);
            marker.userData = this.postData;
            this.mapView.addMarker(marker);
            this.post.lat = args.position.latitude;
            this.post.lng = args.position.longitude;
        }
        console.log("Coordinate Tapped, Lat: " + args.position.latitude + ", Lon: " + args.position.longitude);
    };
    PostEditComponent.prototype.onMarkerEvent = function (args) {
        console.log(args.eventName);
        // if(args.eventName == 'markerInfoWindowTapped') {
        //     this.router.navigate(['/page/posts/' + args.marker.userData.id]);
        // }
        // console.log("Marker Event: '" + args.eventName
        //     + "' triggered on: " + args.marker.title
        //     + ", Lat: " + args.marker.position.latitude + ", Lon: " + args.marker.position.longitude);
    };
    PostEditComponent.prototype.onCameraChanged = function (args) {
        console.log("Camera changed: " + JSON.stringify(args.camera), JSON.stringify(args.camera) === this.lastCamera);
        this.lastCamera = JSON.stringify(args.camera);
    };
    PostEditComponent.prototype.goToMarker = function () {
        this.mapView.latitude = +this.post.lat;
        this.mapView.longitude = +this.post.lng;
        this.mapView.zoom = 17;
        this.mapView.updateCamera();
        this.mapView.updatePadding();
    };
    PostEditComponent.prototype.goBack = function () {
        this.routerExtensions.backToPreviousPage();
    };
    PostEditComponent.prototype.onSave = function () {
        var _this = this;
        this.loadData = true;
        this.postData.editable = false;
        this.apiPostService.savePostEdit(this.post)
            .subscribe(function (response) {
            if (response.success == true) {
                _this.alert(response.message, 'Post Save');
            }
            else {
                _this.alert(response.message, 'Warning');
            }
            _this.loadData = false;
        }, function (error) {
            dialogs_1.alert((JSON.parse(error.text())).message);
            console.log(error.text());
        });
    };
    PostEditComponent.prototype.onEdit = function () {
        this.postData.editable = true;
    };
    PostEditComponent.prototype.alert = function (message, title) {
        return dialogs_1.alert({
            title: title ? title : "APP NAME",
            okButtonText: "OK",
            message: message
        });
    };
    PostEditComponent = __decorate([
        core_1.Component({
            selector: "app-post-edit",
            moduleId: module.id,
            templateUrl: "./post-edit.component.html"
        }),
        __metadata("design:paramtypes", [nativescript_angular_1.RouterExtensions,
            router_1.ActivatedRoute,
            services_1.ApiPostService,
            services_1.ApiGetService,
            router_1.Router])
    ], PostEditComponent);
    return PostEditComponent;
}());
exports.PostEditComponent = PostEditComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9zdC1lZGl0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInBvc3QtZWRpdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBNkQ7QUFDN0QsdURBQWtEO0FBQ2xELDZEQUFzRDtBQUN0RCwwQ0FBdUQ7QUFDdkQsbURBQXFFO0FBQ3JFLDZFQUF1RTtBQUN2RSxtREFBbUQ7QUFDbkQscUVBQW9HO0FBc0JwRztJQWlDSSwyQkFDWSxnQkFBa0MsRUFDbEMsS0FBc0IsRUFDdEIsY0FBK0IsRUFDL0IsYUFBNkIsRUFDN0IsTUFBZTtRQUpmLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsVUFBSyxHQUFMLEtBQUssQ0FBaUI7UUFDdEIsbUJBQWMsR0FBZCxjQUFjLENBQWlCO1FBQy9CLGtCQUFhLEdBQWIsYUFBYSxDQUFnQjtRQUM3QixXQUFNLEdBQU4sTUFBTSxDQUFTO1FBcENwQixlQUFVLEdBQUcsMkJBQTJCLENBQUM7UUFDekMsaUJBQVksR0FBRyxLQUFLLENBQUM7UUFHckIscUJBQWdCLEdBQVcsR0FBRyxDQUFDO1FBQy9CLG9CQUFlLEdBQVcsR0FBRyxDQUFDO1FBQzlCLG9CQUFlLEdBQVcsR0FBRyxDQUFDO1FBQzlCLHFCQUFnQixHQUFXLEdBQUcsQ0FBQztRQUMvQixpQkFBWSxHQUFXLEdBQUcsQ0FBQztRQUdsQyxTQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ1YsWUFBTyxHQUFHLENBQUMsQ0FBQztRQUNaLFlBQU8sR0FBRyxFQUFFLENBQUM7UUFDYixZQUFPLEdBQUcsQ0FBQyxDQUFDO1FBQ1osU0FBSSxHQUFHLENBQUMsQ0FBQztRQUNULFlBQU8sR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBUzNCLGFBQVEsR0FBYSxLQUFLLENBQUM7UUFDM0IsZ0JBQVcsR0FBYSxLQUFLLENBQUM7UUFZMUIsSUFBSSxDQUFDLE9BQU8sR0FBRztZQUNYLGVBQWUsRUFBRSxnQkFBUSxDQUFDLElBQUk7WUFDOUIsY0FBYyxFQUFFLEdBQUc7WUFDbkIsVUFBVSxFQUFFLElBQUk7WUFDaEIsaUJBQWlCLEVBQUUsR0FBRztTQUN6QixDQUFDO1FBQ0YsZ0RBQXFCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUIsSUFBSSxDQUFDLElBQUksR0FBRztZQUNSLEVBQUUsRUFBRyxJQUFJO1lBQ1QsS0FBSyxFQUFFLEVBQUU7WUFDVCxXQUFXLEVBQUUsRUFBRTtZQUNmLEdBQUcsRUFBRSxDQUFDO1lBQ04sR0FBRyxFQUFFLENBQUM7U0FDVCxDQUFDO1FBQ0YsSUFBSSxDQUFDLFFBQVEsR0FBRztZQUNaLEVBQUUsRUFBRSxJQUFJO1lBQ1IsS0FBSyxFQUFFLEVBQUU7WUFDVCxXQUFXLEVBQUUsRUFBRTtZQUNmLEdBQUcsRUFBRSxJQUFJO1lBQ1QsR0FBRyxFQUFFLElBQUk7WUFDVCxPQUFPLEVBQUUsSUFBSTtZQUNiLE9BQU8sRUFBRSxJQUFJO1lBQ2IsVUFBVSxFQUFFLElBQUk7WUFDaEIsVUFBVSxFQUFFLEVBQUU7WUFDZCxVQUFVLEVBQUUsRUFBRTtZQUNkLFFBQVEsRUFBRyxLQUFLO1lBQ2hCLElBQUksRUFBRyxJQUFJLENBQUMsSUFBSTtTQUNuQixDQUFDO0lBRU4sQ0FBQztJQUNELG9DQUFRLEdBQVI7UUFDSSxJQUFJLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQyxpRUFBaUU7SUFFckUsQ0FBQztJQUVELG9DQUFRLEdBQVIsVUFBUyxHQUFZO1FBQXJCLGlCQTZDQztRQTVDRyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUNyQixJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUM7YUFDOUIsU0FBUyxDQUFDLFVBQUMsUUFBYztZQUV0QixFQUFFLENBQUEsQ0FBQyxRQUFRLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQzFCLElBQUksSUFBSSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUM7Z0JBQzFCLEtBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7Z0JBQzNCLEtBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7Z0JBQ2pDLEtBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7Z0JBQzdDLEtBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUM7Z0JBQzdCLEtBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUM7Z0JBQzdCLEtBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUM7Z0JBQ2pDLEtBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUM7Z0JBQ2pDLEtBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUM7Z0JBQzNDLEtBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUM7Z0JBQzNDLEtBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUM7Z0JBQzNDLEtBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztnQkFDL0IsSUFBSTtnQkFDSixLQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDO2dCQUN2QixLQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO2dCQUM3QixLQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO2dCQUN6QyxLQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFD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O0lBQ1AsQ0FBQztJQXhPUSxpQkFBaUI7UUFMN0IsZ0JBQVMsQ0FBQztZQUNQLFFBQVEsRUFBRSxlQUFlO1lBQ3pCLFFBQVEsRUFBRSxNQUFNLENBQUMsRUFBRTtZQUNuQixXQUFXLEVBQUUsNEJBQTRCO1NBQzVDLENBQUM7eUNBbUNnQyx1Q0FBZ0I7WUFDMUIsdUJBQWM7WUFDTCx5QkFBYztZQUNmLHdCQUFhO1lBQ3BCLGVBQU07T0F0Q2xCLGlCQUFpQixDQXlPN0I7SUFBRCx3QkFBQztDQUFBLEFBek9ELElBeU9DO0FBek9ZLDhDQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGQgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHthbGVydH0gZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdWkvZGlhbG9nc1wiO1xuaW1wb3J0IHtSb3V0ZXJFeHRlbnNpb25zfSBmcm9tIFwibmF0aXZlc2NyaXB0LWFuZ3VsYXJcIjtcbmltcG9ydCB7QWN0aXZhdGVkUm91dGUsIFJvdXRlcn0gZnJvbSBcIkBhbmd1bGFyL3JvdXRlclwiO1xuaW1wb3J0IHtBcGlHZXRTZXJ2aWNlLCBBcGlQb3N0U2VydmljZX0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvc2VydmljZXNcIjtcbmltcG9ydCB7TWFwVmlldywgTWFya2VyLCBQb3NpdGlvbn0gZnJvbSBcIm5hdGl2ZXNjcmlwdC1nb29nbGUtbWFwcy1zZGtcIjtcbmltcG9ydCB7QWNjdXJhY3l9IGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL3VpL2VudW1zXCI7XG5pbXBvcnQge2NsZWFyV2F0Y2gsIGVuYWJsZUxvY2F0aW9uUmVxdWVzdCwgTG9jYXRpb24sIHdhdGNoTG9jYXRpb259IGZyb20gXCJuYXRpdmVzY3JpcHQtZ2VvbG9jYXRpb25cIjtcbmltcG9ydCB7cG9zdEZvcm19IGZyb20gXCIuLi8uLi8uLi9jb3JlL21vZGVsc1wiO1xuXG5pbnRlcmZhY2UgcG9zdERhdGEge1xuICAgIGlkOiBudW1iZXI7XG4gICAgdGl0bGU6IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICAgIGxhdDogbnVtYmVyO1xuICAgIGxuZzogbnVtYmVyO1xuICAgIG1hcF9sYXQ6IG51bWJlcjtcbiAgICBtYXBfbG5nOiBudW1iZXI7XG4gICAgY3JlYXRlZF9ieTogbnVtYmVyO1xuICAgIGNyZWF0ZWRfYXQ6IHN0cmluZztcbiAgICB1cGRhdGVkX2F0OiBzdHJpbmc7XG4gICAgZWRpdGFibGUgOiBib29sZWFuO1xuICAgIGZvcm0gOiBwb3N0Rm9ybVxufVxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6IFwiYXBwLXBvc3QtZWRpdFwiLFxuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgdGVtcGxhdGVVcmw6IFwiLi9wb3N0LWVkaXQuY29tcG9uZW50Lmh0bWxcIlxufSlcbmV4cG9ydCBjbGFzcyBQb3N0RWRpdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgICBwdWJsaWMgYnV0dG9uVGV4dCA9IFwiU3RhcnQgbG9jYXRpb24gbW9uaXRvcmluZ1wiO1xuICAgIHB1YmxpYyBpc01vbml0b3JpbmcgPSBmYWxzZTtcbiAgICBwdWJsaWMgb3B0aW9ucztcbiAgICBwdWJsaWMgbGlzdGVuZXI7XG4gICAgcHVibGljIG1vbml0b3JMb25naXR1ZGU6IHN0cmluZyA9IFwiMFwiO1xuICAgIHB1YmxpYyBtb25pdG9yTGF0aXR1ZGU6IHN0cmluZyA9IFwiMFwiO1xuICAgIHB1YmxpYyBtb25pdG9yQWx0aXR1ZGU6IHN0cmluZyA9IFwiMFwiO1xuICAgIHB1YmxpYyBtb25pdG9yRGlyZWN0aW9uOiBzdHJpbmcgPSBcIjBcIjtcbiAgICBwdWJsaWMgbW9uaXRvclNwZWVkOiBzdHJpbmcgPSBcIjBcIjtcblxuXG4gICAgem9vbSA9IDEyO1xuICAgIG1pblpvb20gPSAwO1xuICAgIG1heFpvb20gPSAyMjtcbiAgICBiZWFyaW5nID0gMDtcbiAgICB0aWx0ID0gMDtcbiAgICBwYWRkaW5nID0gWzQwLCA0MCwgNDAsIDQwXTtcbiAgICBtYXBWaWV3OiBNYXBWaWV3O1xuXG4gICAgbWFya2VyTGF0TG5nIDogc3RyaW5nO1xuXG4gICAgaWQ7XG4gICAgcmV0dXJuVXJsO1xuICAgIHBvc3QgOiBwb3N0Rm9ybTtcbiAgICBwb3N0RGF0YSA6IHBvc3REYXRhO1xuICAgIGxvYWREYXRhIDogYm9vbGVhbiA9IGZhbHNlO1xuICAgIGlzU3VibWl0aW5nIDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgbGFzdENhbWVyYTogU3RyaW5nO1xuXG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSByb3V0ZXJFeHRlbnNpb25zOiBSb3V0ZXJFeHRlbnNpb25zLFxuICAgICAgICBwcml2YXRlIHJvdXRlIDogQWN0aXZhdGVkUm91dGUsXG4gICAgICAgIHByaXZhdGUgYXBpUG9zdFNlcnZpY2UgOiBBcGlQb3N0U2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBhcGlHZXRTZXJ2aWNlIDogQXBpR2V0U2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSByb3V0ZXIgOiBSb3V0ZXJcbiAgICApIHtcbiAgICAgICAgdGhpcy5vcHRpb25zID0ge1xuICAgICAgICAgICAgZGVzaXJlZEFjY3VyYWN5OiBBY2N1cmFjeS5oaWdoLFxuICAgICAgICAgICAgdXBkYXRlRGlzdGFuY2U6IDAuMSxcbiAgICAgICAgICAgIHVwZGF0ZVRpbWU6IDMwMDAsXG4gICAgICAgICAgICBtaW5pbXVtVXBkYXRlVGltZTogMTAwXG4gICAgICAgIH07XG4gICAgICAgIGVuYWJsZUxvY2F0aW9uUmVxdWVzdCh0cnVlKTtcbiAgICAgICAgdGhpcy5wb3N0ID0ge1xuICAgICAgICAgICAgaWQgOiBudWxsLFxuICAgICAgICAgICAgdGl0bGU6ICcnLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICcnLFxuICAgICAgICAgICAgbGF0OiAwLFxuICAgICAgICAgICAgbG5nOiAwXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucG9zdERhdGEgPSB7XG4gICAgICAgICAgICBpZDogbnVsbCxcbiAgICAgICAgICAgIHRpdGxlOiAnJyxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnJyxcbiAgICAgICAgICAgIGxhdDogbnVsbCxcbiAgICAgICAgICAgIGxuZzogbnVsbCxcbiAgICAgICAgICAgIG1hcF9sYXQ6IG51bGwsXG4gICAgICAgICAgICBtYXBfbG5nOiBudWxsLFxuICAgICAgICAgICAgY3JlYXRlZF9ieTogbnVsbCxcbiAgICAgICAgICAgIGNyZWF0ZWRfYXQ6ICcnLFxuICAgICAgICAgICAgdXBkYXRlZF9hdDogJycsXG4gICAgICAgICAgICBlZGl0YWJsZSA6IGZhbHNlLFxuICAgICAgICAgICAgZm9ybSA6IHRoaXMucG9zdFxuICAgICAgICB9O1xuXG4gICAgfVxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLmlkID0gdGhpcy5yb3V0ZS5zbmFwc2hvdC5wYXJhbXNbJ2lkJ107XG4gICAgICAgIC8vIHRoaXMucmV0dXJuVXJsID0gdGhpcy5yb3V0ZS5zbmFwc2hvdC5xdWVyeVBhcmFtc1sncmV0dXJuVXJsJ107XG5cbiAgICB9XG5cbiAgICBsb2FkUG9zdChfaWQgOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5sb2FkRGF0YSA9IHRydWU7XG4gICAgICAgIHRoaXMuYXBpR2V0U2VydmljZS5nZXRVc2VyUG9zdChfaWQpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKChyZXNwb25zZSA6IGFueSkgPT4ge1xuXG4gICAgICAgICAgICAgICAgaWYocmVzcG9uc2Uuc3VjY2VzcyA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3N0ID0gcmVzcG9uc2UucG9zdHM7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9zdERhdGEuaWQgPSBwb3N0LmlkO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBvc3REYXRhLnRpdGxlID0gcG9zdC50aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3N0RGF0YS5kZXNjcmlwdGlvbiA9IHBvc3QuZGVzY3JpcHRpb247XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9zdERhdGEubGF0ID0gcG9zdC5sYXQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9zdERhdGEubG5nID0gcG9zdC5sbmc7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9zdERhdGEubWFwX2xhdCA9IHBvc3QubGF0O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBvc3REYXRhLm1hcF9sbmcgPSBwb3N0LmxuZztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3N0RGF0YS5jcmVhdGVkX2J5ID0gcG9zdC5jcmVhdGVkX2J5O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBvc3REYXRhLmNyZWF0ZWRfYXQgPSBwb3N0LmNyZWF0ZWRfYXQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9zdERhdGEudXBkYXRlZF9hdCA9IHBvc3QudXBkYXRlZF9hdDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3N0RGF0YS5lZGl0YWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAvLyAvXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9zdC5pZCA9IHBvc3QuaWQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9zdC50aXRsZSA9IHBvc3QudGl0bGU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9zdC5kZXNjcmlwdGlvbiA9IHBvc3QuZGVzY3JpcHRpb247XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9zdC5sYXQgPSBwb3N0LmxhdDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3N0LmxuZyA9IHBvc3QubG5nO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hcmtlciA9IG5ldyBNYXJrZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgbWFya2VyLnBvc2l0aW9uID0gUG9zaXRpb24ucG9zaXRpb25Gcm9tTGF0TG5nKHRoaXMucG9zdC5sYXQsIHRoaXMucG9zdC5sbmcpO1xuICAgICAgICAgICAgICAgICAgICAvLyBtYXJrZXIudGl0bGUgPSB0aGlzLnBvc3QudGl0bGU7XG4gICAgICAgICAgICAgICAgICAgIG1hcmtlci51c2VyRGF0YSA9IHRoaXMucG9zdERhdGE7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWFwVmlldy5hZGRNYXJrZXIobWFya2VyKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLm1hcFZpZXcubGF0aXR1ZGUgPSArdGhpcy5wb3N0LmxhdDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXBWaWV3LmxvbmdpdHVkZSA9ICt0aGlzLnBvc3QubG5nO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1hcFZpZXcuem9vbSA9IDE1O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1hcFZpZXcudXBkYXRlQ2FtZXJhKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWFwVmlldy51cGRhdGVQYWRkaW5nKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMubG9hZERhdGEgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQoKEpTT04ucGFyc2UoZXJyb3IudGV4dCgpKSkubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yLnRleHQoKSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICAvL01hcCBldmVudHNcbiAgICBvbk1hcFJlYWR5KGV2ZW50KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdNYXAgUmVhZHknKTtcbiAgICAgICAgdGhpcy5tYXBWaWV3ID0gZXZlbnQub2JqZWN0O1xuICAgICAgICB2YXIgZ01hcCA9IGV2ZW50LmdNYXA7XG4gICAgICAgIC8vIGdNYXAuc2V0TXlMb2NhdGlvbkVuYWJsZWQodHJ1ZSk7XG4gICAgICAgIHRoaXMubWFwVmlldy5teUxvY2F0aW9uRW5hYmxlZCA9IHRydWU7XG5cblxuICAgICAgICB0aGlzLmxvYWRQb3N0KHRoaXMuaWQpO1xuICAgICAgICAvLyB0aGlzLm1vbml0b3IoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgbW9uaXRvcihhcmdzPykge1xuICAgICAgICAvLyA+PiBsb2NhdGlvbi1tb25pdG9yaW5nXG4gICAgICAgIGlmICh0aGlzLmlzTW9uaXRvcmluZykge1xuICAgICAgICAgICAgY2xlYXJXYXRjaCh0aGlzLmxpc3RlbmVyKTtcbiAgICAgICAgICAgIHRoaXMuaXNNb25pdG9yaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmJ1dHRvblRleHQgPSBcIlN0YXJ0IGxvY2F0aW9uIG1vbml0b3JpbmdcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubGlzdGVuZXIgPSB3YXRjaExvY2F0aW9uKChsb2M6IExvY2F0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGxvYykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vbml0b3JMb25naXR1ZGUgPSAobG9jLmxvbmdpdHVkZSkudG9GaXhlZCg0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb25pdG9yTGF0aXR1ZGUgPSAobG9jLmxhdGl0dWRlKS50b0ZpeGVkKDQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vbml0b3JBbHRpdHVkZSA9IChsb2MuYWx0aXR1ZGUpLnRvRml4ZWQoMik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW9uaXRvckRpcmVjdGlvbiA9IChsb2MuZGlyZWN0aW9uKS50b0ZpeGVkKDIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vbml0b3JTcGVlZCA9IChsb2Muc3BlZWQpLnRvRml4ZWQoMik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgKGUpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yOiBcIiArIGUubWVzc2FnZSk7XG4gICAgICAgICAgICB9LCB0aGlzLm9wdGlvbnMpO1xuXG4gICAgICAgICAgICB0aGlzLmlzTW9uaXRvcmluZyA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmJ1dHRvblRleHQgPSBcIlN0b3AgbG9jYXRpb24gbW9uaXRvcmluZ1wiO1xuICAgICAgICB9XG4gICAgICAgIC8vIDw8IGxvY2F0aW9uLW1vbml0b3JpbmdcbiAgICB9XG5cbiAgICBvbkNvb3JkaW5hdGVUYXBwZWQoYXJncykge1xuICAgICAgICBpZih0aGlzLnBvc3REYXRhLmVkaXRhYmxlKSB7XG4gICAgICAgICAgICB0aGlzLm1hcFZpZXcucmVtb3ZlQWxsTWFya2VycygpO1xuICAgICAgICAgICAgdmFyIG1hcmtlciA9IG5ldyBNYXJrZXIoKTtcbiAgICAgICAgICAgIG1hcmtlci5wb3NpdGlvbiA9IFBvc2l0aW9uLnBvc2l0aW9uRnJvbUxhdExuZyhhcmdzLnBvc2l0aW9uLmxhdGl0dWRlLCBhcmdzLnBvc2l0aW9uLmxvbmdpdHVkZSk7XG4gICAgICAgICAgICBtYXJrZXIudXNlckRhdGEgPSB0aGlzLnBvc3REYXRhO1xuICAgICAgICAgICAgdGhpcy5tYXBWaWV3LmFkZE1hcmtlcihtYXJrZXIpO1xuICAgICAgICAgICAgdGhpcy5wb3N0LmxhdCA9IGFyZ3MucG9zaXRpb24ubGF0aXR1ZGU7XG4gICAgICAgICAgICB0aGlzLnBvc3QubG5nID0gYXJncy5wb3NpdGlvbi5sb25naXR1ZGU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coXCJDb29yZGluYXRlIFRhcHBlZCwgTGF0OiBcIiArIGFyZ3MucG9zaXRpb24ubGF0aXR1ZGUgKyBcIiwgTG9uOiBcIiArIGFyZ3MucG9zaXRpb24ubG9uZ2l0dWRlKTtcbiAgICB9XG5cbiAgICBvbk1hcmtlckV2ZW50KGFyZ3MpIHtcbiAgICAgICAgY29uc29sZS5sb2coYXJncy5ldmVudE5hbWUpO1xuICAgICAgICAvLyBpZihhcmdzLmV2ZW50TmFtZSA9PSAnbWFya2VySW5mb1dpbmRvd1RhcHBlZCcpIHtcbiAgICAgICAgLy8gICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFsnL3BhZ2UvcG9zdHMvJyArIGFyZ3MubWFya2VyLnVzZXJEYXRhLmlkXSk7XG4gICAgICAgIC8vIH1cbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJNYXJrZXIgRXZlbnQ6ICdcIiArIGFyZ3MuZXZlbnROYW1lXG4gICAgICAgIC8vICAgICArIFwiJyB0cmlnZ2VyZWQgb246IFwiICsgYXJncy5tYXJrZXIudGl0bGVcbiAgICAgICAgLy8gICAgICsgXCIsIExhdDogXCIgKyBhcmdzLm1hcmtlci5wb3NpdGlvbi5sYXRpdHVkZSArIFwiLCBMb246IFwiICsgYXJncy5tYXJrZXIucG9zaXRpb24ubG9uZ2l0dWRlKTtcbiAgICB9XG5cbiAgICBvbkNhbWVyYUNoYW5nZWQoYXJncykge1xuICAgICAgICBjb25zb2xlLmxvZyhcIkNhbWVyYSBjaGFuZ2VkOiBcIiArIEpTT04uc3RyaW5naWZ5KGFyZ3MuY2FtZXJhKSwgSlNPTi5zdHJpbmdpZnkoYXJncy5jYW1lcmEpID09PSB0aGlzLmxhc3RDYW1lcmEpO1xuICAgICAgICB0aGlzLmxhc3RDYW1lcmEgPSBKU09OLnN0cmluZ2lmeShhcmdzLmNhbWVyYSk7XG4gICAgfVxuXG4gICAgZ29Ub01hcmtlcigpIHtcbiAgICAgICAgdGhpcy5tYXBWaWV3LmxhdGl0dWRlID0gK3RoaXMucG9zdC5sYXQ7XG4gICAgICAgIHRoaXMubWFwVmlldy5sb25naXR1ZGUgPSArdGhpcy5wb3N0LmxuZztcbiAgICAgICAgdGhpcy5tYXBWaWV3Lnpvb20gPSAxNztcbiAgICAgICAgdGhpcy5tYXBWaWV3LnVwZGF0ZUNhbWVyYSgpO1xuICAgICAgICB0aGlzLm1hcFZpZXcudXBkYXRlUGFkZGluZygpO1xuICAgIH1cblxuICAgIGdvQmFjaygpIHtcbiAgICAgICAgdGhpcy5yb3V0ZXJFeHRlbnNpb25zLmJhY2tUb1ByZXZpb3VzUGFnZSgpO1xuICAgIH1cblxuICAgIG9uU2F2ZSgpIHtcblxuICAgICAgICB0aGlzLmxvYWREYXRhID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5wb3N0RGF0YS5lZGl0YWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmFwaVBvc3RTZXJ2aWNlLnNhdmVQb3N0RWRpdCh0aGlzLnBvc3QpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKChyZXNwb25zZSA6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZihyZXNwb25zZS5zdWNjZXNzID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWxlcnQocmVzcG9uc2UubWVzc2FnZSwgJ1Bvc3QgU2F2ZScpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hbGVydChyZXNwb25zZS5tZXNzYWdlLCAnV2FybmluZycpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZERhdGEgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQoKEpTT04ucGFyc2UoZXJyb3IudGV4dCgpKSkubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yLnRleHQoKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgb25FZGl0KCkge1xuICAgICAgICB0aGlzLnBvc3REYXRhLmVkaXRhYmxlID0gdHJ1ZTtcbiAgICB9XG5cblxuICAgIGFsZXJ0KG1lc3NhZ2U6IHN0cmluZywgdGl0bGU/OiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIGFsZXJ0KHtcbiAgICAgICAgICAgIHRpdGxlOiB0aXRsZSA/IHRpdGxlIDogXCJBUFAgTkFNRVwiLFxuICAgICAgICAgICAgb2tCdXR0b25UZXh0OiBcIk9LXCIsXG4gICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlXG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiJdfQ==
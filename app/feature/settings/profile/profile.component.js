"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var dialogs_1 = require("tns-core-modules/ui/dialogs");
var services_1 = require("../../../core/services");
var ProfileComponent = /** @class */ (function () {
    function ProfileComponent(authenticationService, apiGetService) {
        this.authenticationService = authenticationService;
        this.apiGetService = apiGetService;
        this.loadData = false;
        this.isSubmiting = false;
        this.countries = [];
        this.genders = [];
        this.genderSelected = 'None';
        this.countrySelected = 'None';
        this.statusChange = new core_1.EventEmitter();
        this.test = 'Waiting!';
        this.editUserForm = false;
        this.user = {
            name: '',
            email: '',
            created_at: '',
            title: '',
            about: '',
            gender: 'other',
            country: null
        };
        this.user_default = {
            name: '',
            email: '',
            created_at: '',
            title: '',
            about: '',
            gender: 'other',
            country: null
        };
        // Use the constructor to inject services.
        this.genders.push({ key: 'man', value: 'Man' }, { key: 'woman', value: 'Woman' }, { key: 'other', value: 'Other' });
        console.log('profile construct');
    }
    ProfileComponent.prototype.ngOnInit = function () {
        // Use the "ngOnInit" handler to initialize data for the view.
        this.loadUser();
    };
    ProfileComponent.prototype.onSave = function () {
        this.test = 'ITs save';
        this.submit(this.user);
    };
    ProfileComponent.prototype.onEdit = function () {
        this.test = 'ITs edit';
        this.editForm();
    };
    ProfileComponent.prototype.onCancel = function () {
        this.editForm();
    };
    // Load data
    ProfileComponent.prototype.loadUser = function () {
        var _this = this;
        this.loadData = true;
        this.authenticationService.getUser()
            .subscribe(function (response) {
            _this.user.name = response.name;
            _this.user.email = response.email;
            _this.user.created_at = response.created_at;
            _this.user.gender = response.gender;
            _this.user.title = response.title;
            _this.user.about = response.about;
            _this.user.country = response.country_id;
            _this.user_default.name = response.name;
            _this.user_default.email = response.email;
            _this.user_default.created_at = response.created_at;
            _this.user_default.gender = response.gender;
            _this.user_default.title = response.title;
            _this.user_default.about = response.about;
            _this.user_default.country = response.country_id;
            // this.loadData = false;
            _this.loadCountries();
            //
            _this.genderSelected = _this.getGenderText(_this.user.gender);
        }, function (error) {
            dialogs_1.alert((JSON.parse(error.text())).message);
            console.log(error.text());
        });
    };
    ;
    ProfileComponent.prototype.loadCountries = function () {
        var _this = this;
        this.apiGetService.getCountriesList()
            .subscribe(function (response) {
            _this.countries = response.list;
            _this.countrySelected = _this.getCountryText(_this.user.country);
            _this.loadData = false;
        }, function (error) {
            dialogs_1.alert((JSON.parse(error.text())).message);
            console.log(error.text());
        });
    };
    // Focus elements
    ProfileComponent.prototype.focusTitle = function () {
        this.title.nativeElement.focus();
    };
    ProfileComponent.prototype.focusAbout = function () {
        this.about.nativeElement.focus();
    };
    // Dialogs
    ProfileComponent.prototype.displayGenderDialog = function (_status) {
        var _this = this;
        if (_status == false) {
            return;
        }
        // >> action-dialog-code
        var genderActions = [];
        for (var v in this.genders) {
            genderActions.push(this.genders[v].value);
        }
        var options = {
            title: "Gender selection",
            message: "Choose your gender",
            cancelButtonText: "Cancel",
            actions: genderActions
        };
        dialogs_1.action(options).then(function (result) {
            if (result != 'Cancel') {
                var _gender_id = void 0;
                for (var v in _this.genders) {
                    if (_this.genders[v].value == result) {
                        _gender_id = v;
                    }
                }
                _this.genderSelected = _this.genders[_gender_id].value;
                _this.user.gender = _this.genders[_gender_id].key;
            }
        });
        // << action-dialog-code
    };
    ProfileComponent.prototype.displayCountryDialog = function (_status) {
        var _this = this;
        // >> action-dialog-code
        console.log(_status);
        if (_status == false) {
            return;
        }
        var countryActions = [];
        for (var v in this.countries) {
            countryActions.push(this.countries[v].name);
        }
        var options = {
            title: "Country selection",
            message: "Choose your country",
            cancelButtonText: "Cancel",
            actions: countryActions
        };
        dialogs_1.action(options).then(function (result) {
            if (result != 'Cancel') {
                var _country_id = void 0;
                for (var v in _this.countries) {
                    if (_this.countries[v].name == result) {
                        _country_id = v;
                    }
                }
                _this.countrySelected = _this.countries[_country_id].name;
                _this.user.country = _this.countries[_country_id].id;
            }
        });
        // << action-dialog-code
    };
    ProfileComponent.prototype.selectedIndexChanged = function (args) {
        var picker = args.object;
        console.log("picker selection: " + picker.selectedIndex);
    };
    ProfileComponent.prototype.getGenderText = function (name) {
        for (var v in this.genders) {
            if (this.genders[v].key == name) {
                return this.genders[v].value;
            }
        }
        return 'Null';
    };
    ProfileComponent.prototype.getCountryText = function (name) {
        for (var v in this.countries) {
            if (this.countries[v].id == name) {
                return this.countries[v].name;
            }
        }
        return 'Null';
    };
    ProfileComponent.prototype.editForm = function () {
        this.editUserForm = !this.editUserForm;
        this.statusChange.emit(this.editUserForm);
        if (!this.editUserForm) {
            console.log('Here is me');
            // Reset interface
            this.user.name = this.user_default.name;
            this.user.email = this.user_default.email;
            this.user.created_at = this.user_default.created_at;
            this.user.gender = this.user_default.gender;
            console.log(this.user.title + ' = ' + this.user_default.title);
            this.user.title = this.user_default.title;
            this.user.about = this.user_default.about;
            this.user.country = this.user_default.country;
            // Fill values
            this.genderSelected = this.getGenderText(this.user.gender);
            this.countrySelected = this.getCountryText(this.user.country);
        }
    };
    ProfileComponent.prototype.submit = function (value) {
        var _this = this;
        this.editUserForm = false;
        this.loadData = true;
        this.authenticationService.changeProfileInfo(value)
            .subscribe(function (response) {
            if (response.success === true) {
                _this.loadData = false;
                _this.statusChange.emit(false);
                _this.alert('Changes was Saved');
            }
            else {
                // false
                _this.alert(response.message);
            }
        }, function (error) {
            dialogs_1.alert((JSON.parse(error.text())).message);
            console.log(error.text());
        });
    };
    ProfileComponent.prototype.alert = function (message) {
        return dialogs_1.alert({
            title: "Profile",
            okButtonText: "OK",
            message: message
        });
    };
    __decorate([
        core_1.Output(),
        __metadata("design:type", Object)
    ], ProfileComponent.prototype, "statusChange", void 0);
    __decorate([
        core_1.ViewChild("title"),
        __metadata("design:type", core_1.ElementRef)
    ], ProfileComponent.prototype, "title", void 0);
    __decorate([
        core_1.ViewChild("about"),
        __metadata("design:type", core_1.ElementRef)
    ], ProfileComponent.prototype, "about", void 0);
    ProfileComponent = __decorate([
        core_1.Component({
            selector: "Profile",
            moduleId: module.id,
            templateUrl: "./profile.component.html"
        }),
        __metadata("design:paramtypes", [services_1.AuthenticationService,
            services_1.ApiGetService])
    ], ProfileComponent);
    return ProfileComponent;
}());
exports.ProfileComponent = ProfileComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZmlsZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJwcm9maWxlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNDQUFvRztBQUVwRyx1REFBMEQ7QUFDMUQsbURBQTRFO0FBYzVFO0lBa0NJLDBCQUNZLHFCQUE2QyxFQUM3QyxhQUE2QjtRQUQ3QiwwQkFBcUIsR0FBckIscUJBQXFCLENBQXdCO1FBQzdDLGtCQUFhLEdBQWIsYUFBYSxDQUFnQjtRQWxDekMsYUFBUSxHQUFhLEtBQUssQ0FBQztRQUMzQixnQkFBVyxHQUFhLEtBQUssQ0FBQztRQUM5QixjQUFTLEdBQWlCLEVBQUUsQ0FBQztRQUM3QixZQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2IsbUJBQWMsR0FBVyxNQUFNLENBQUM7UUFDaEMsb0JBQWUsR0FBVyxNQUFNLENBQUM7UUFDdkIsaUJBQVksR0FBRyxJQUFJLG1CQUFZLEVBQVcsQ0FBQztRQUlyRCxTQUFJLEdBQUcsVUFBVSxDQUFDO1FBRWxCLGlCQUFZLEdBQWEsS0FBSyxDQUFDO1FBQy9CLFNBQUksR0FBaUI7WUFDakIsSUFBSSxFQUFHLEVBQUU7WUFDVCxLQUFLLEVBQUcsRUFBRTtZQUNWLFVBQVUsRUFBRyxFQUFFO1lBQ2YsS0FBSyxFQUFHLEVBQUU7WUFDVixLQUFLLEVBQUcsRUFBRTtZQUNWLE1BQU0sRUFBRyxPQUFPO1lBQ2hCLE9BQU8sRUFBRyxJQUFJO1NBQ2pCLENBQUM7UUFDRixpQkFBWSxHQUFpQjtZQUN6QixJQUFJLEVBQUcsRUFBRTtZQUNULEtBQUssRUFBRyxFQUFFO1lBQ1YsVUFBVSxFQUFHLEVBQUU7WUFDZixLQUFLLEVBQUcsRUFBRTtZQUNWLEtBQUssRUFBRyxFQUFFO1lBQ1YsTUFBTSxFQUFHLE9BQU87WUFDaEIsT0FBTyxFQUFHLElBQUk7U0FDakIsQ0FBQztRQU1FLDBDQUEwQztRQUMxQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FDYixFQUFDLEdB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QUNuQixXQUFXLEVBQUUsMEJBQTBCO1NBQzFDLENBQUM7eUNBb0NzQyxnQ0FBcUI7WUFDN0Isd0JBQWE7T0FwQ2hDLGdCQUFnQixDQStQNUI7SUFBRCx1QkFBQztDQUFBLEFBL1BELElBK1BDO0FBL1BZLDRDQUFnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkluaXQsIE91dHB1dCwgVmlld0NoaWxkfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHtMaXN0UGlja2VyfSBmcm9tIFwidG5zLWNvcmUtbW9kdWxlcy91aS9saXN0LXBpY2tlclwiO1xuaW1wb3J0IHthY3Rpb24sIGFsZXJ0fSBmcm9tIFwidG5zLWNvcmUtbW9kdWxlcy91aS9kaWFsb2dzXCI7XG5pbXBvcnQge0FwaUdldFNlcnZpY2UsIEF1dGhlbnRpY2F0aW9uU2VydmljZX0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvc2VydmljZXNcIjtcbmltcG9ydCB7cHJvZmlsZUZvcm19IGZyb20gXCIuLi8uLi8uLi9jb3JlL21vZGVsc1wiO1xuXG5cbmV4cG9ydCBpbnRlcmZhY2UgY291bnRyaWVzIHtcbiAgICBpZCA6IG51bWJlcjtcbiAgICBuYW1lIDogc3RyaW5nO1xufVxuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogXCJQcm9maWxlXCIsXG4gICAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcbiAgICB0ZW1wbGF0ZVVybDogXCIuL3Byb2ZpbGUuY29tcG9uZW50Lmh0bWxcIlxufSlcbmV4cG9ydCBjbGFzcyBQcm9maWxlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICAgIGxvYWREYXRhIDogYm9vbGVhbiA9IGZhbHNlO1xuICAgIGlzU3VibWl0aW5nIDogYm9vbGVhbiA9IGZhbHNlO1xuICAgIGNvdW50cmllcyA6IGNvdW50cmllc1tdID0gW107XG4gICAgZ2VuZGVycyA9IFtdO1xuICAgIGdlbmRlclNlbGVjdGVkOiBzdHJpbmcgPSAnTm9uZSc7XG4gICAgY291bnRyeVNlbGVjdGVkOiBzdHJpbmcgPSAnTm9uZSc7XG4gICAgQE91dHB1dCgpIHN0YXR1c0NoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcbiAgICBAVmlld0NoaWxkKFwidGl0bGVcIikgdGl0bGU6IEVsZW1lbnRSZWY7XG4gICAgQFZpZXdDaGlsZChcImFib3V0XCIpIGFib3V0OiBFbGVtZW50UmVmO1xuXG4gICAgdGVzdCA9ICdXYWl0aW5nISc7XG5cbiAgICBlZGl0VXNlckZvcm0gOiBib29sZWFuID0gZmFsc2U7XG4gICAgdXNlciA6IHByb2ZpbGVGb3JtID0ge1xuICAgICAgICBuYW1lIDogJycsXG4gICAgICAgIGVtYWlsIDogJycsXG4gICAgICAgIGNyZWF0ZWRfYXQgOiAnJyxcbiAgICAgICAgdGl0bGUgOiAnJyxcbiAgICAgICAgYWJvdXQgOiAnJyxcbiAgICAgICAgZ2VuZGVyIDogJ290aGVyJyxcbiAgICAgICAgY291bnRyeSA6IG51bGxcbiAgICB9O1xuICAgIHVzZXJfZGVmYXVsdCA6IHByb2ZpbGVGb3JtID0ge1xuICAgICAgICBuYW1lIDogJycsXG4gICAgICAgIGVtYWlsIDogJycsXG4gICAgICAgIGNyZWF0ZWRfYXQgOiAnJyxcbiAgICAgICAgdGl0bGUgOiAnJyxcbiAgICAgICAgYWJvdXQgOiAnJyxcbiAgICAgICAgZ2VuZGVyIDogJ290aGVyJyxcbiAgICAgICAgY291bnRyeSA6IG51bGxcbiAgICB9O1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgYXV0aGVudGljYXRpb25TZXJ2aWNlIDogQXV0aGVudGljYXRpb25TZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGFwaUdldFNlcnZpY2UgOiBBcGlHZXRTZXJ2aWNlXG4gICAgKSB7XG4gICAgICAgIC8vIFVzZSB0aGUgY29uc3RydWN0b3IgdG8gaW5qZWN0IHNlcnZpY2VzLlxuICAgICAgICB0aGlzLmdlbmRlcnMucHVzaChcbiAgICAgICAgICAgIHtrZXkgOiAnbWFuJywgdmFsdWUgOiAnTWFuJ30sXG4gICAgICAgICAgICB7a2V5IDogJ3dvbWFuJywgdmFsdWUgOiAnV29tYW4nfSxcbiAgICAgICAgICAgIHtrZXkgOiAnb3RoZXInLCB2YWx1ZSA6ICdPdGhlcid9XG4gICAgICAgICk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdwcm9maWxlIGNvbnN0cnVjdCcpO1xuICAgIH1cblxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIC8vIFVzZSB0aGUgXCJuZ09uSW5pdFwiIGhhbmRsZXIgdG8gaW5pdGlhbGl6ZSBkYXRhIGZvciB0aGUgdmlldy5cbiAgICAgICAgdGhpcy5sb2FkVXNlcigpO1xuICAgIH1cblxuICAgIG9uU2F2ZSgpe1xuICAgICAgICB0aGlzLnRlc3QgPSAnSVRzIHNhdmUnO1xuXG4gICAgICAgIHRoaXMuc3VibWl0KHRoaXMudXNlcik7XG4gICAgfVxuICAgIG9uRWRpdCgpIHtcbiAgICAgICAgdGhpcy50ZXN0ID0gJ0lUcyBlZGl0JztcbiAgICAgICAgdGhpcy5lZGl0Rm9ybSgpO1xuICAgIH1cbiAgICBvbkNhbmNlbCgpIHtcbiAgICAgICAgdGhpcy5lZGl0Rm9ybSgpO1xuICAgIH1cblxuICAgIC8vIExvYWQgZGF0YVxuICAgIGxvYWRVc2VyKCkge1xuICAgICAgICB0aGlzLmxvYWREYXRhID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5hdXRoZW50aWNhdGlvblNlcnZpY2UuZ2V0VXNlcigpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKChyZXNwb25zZSA6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXIubmFtZSA9IHJlc3BvbnNlLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXNlci5lbWFpbCA9IHJlc3BvbnNlLmVtYWlsO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXIuY3JlYXRlZF9hdCA9IHJlc3BvbnNlLmNyZWF0ZWRfYXQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXNlci5nZW5kZXIgPSByZXNwb25zZS5nZW5kZXI7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXNlci50aXRsZSA9IHJlc3BvbnNlLnRpdGxlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXIuYWJvdXQgPSByZXNwb25zZS5hYm91dDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VyLmNvdW50cnkgPSByZXNwb25zZS5jb3VudHJ5X2lkO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXNlcl9kZWZhdWx0Lm5hbWUgPSByZXNwb25zZS5uYW1lO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXJfZGVmYXVsdC5lbWFpbCA9IHJlc3BvbnNlLmVtYWlsO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXJfZGVmYXVsdC5jcmVhdGVkX2F0ID0gcmVzcG9uc2UuY3JlYXRlZF9hdDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VyX2RlZmF1bHQuZ2VuZGVyID0gcmVzcG9uc2UuZ2VuZGVyO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXJfZGVmYXVsdC50aXRsZSA9IHJlc3BvbnNlLnRpdGxlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXJfZGVmYXVsdC5hYm91dCA9IHJlc3BvbnNlLmFib3V0O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXJfZGVmYXVsdC5jb3VudHJ5ID0gcmVzcG9uc2UuY291bnRyeV9pZDtcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5sb2FkRGF0YSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRDb3VudHJpZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5kZXJTZWxlY3RlZCA9IHRoaXMuZ2V0R2VuZGVyVGV4dCh0aGlzLnVzZXIuZ2VuZGVyKTtcblxuXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KChKU09OLnBhcnNlKGVycm9yLnRleHQoKSkpLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvci50ZXh0KCkpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgIH07XG4gICAgbG9hZENvdW50cmllcygpIHtcbiAgICAgICAgdGhpcy5hcGlHZXRTZXJ2aWNlLmdldENvdW50cmllc0xpc3QoKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgocmVzcG9uc2UgOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvdW50cmllcyA9IHJlc3BvbnNlLmxpc3Q7XG4gICAgICAgICAgICAgICAgdGhpcy5jb3VudHJ5U2VsZWN0ZWQgPSB0aGlzLmdldENvdW50cnlUZXh0KHRoaXMudXNlci5jb3VudHJ5KTtcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWREYXRhID0gZmFsc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIGFsZXJ0KChKU09OLnBhcnNlKGVycm9yLnRleHQoKSkpLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yLnRleHQoKSk7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBGb2N1cyBlbGVtZW50c1xuICAgIGZvY3VzVGl0bGUoKSB7XG4gICAgICAgIHRoaXMudGl0bGUubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgIH1cbiAgICBmb2N1c0Fib3V0KCkge1xuICAgICAgICB0aGlzLmFib3V0Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICB9XG5cbiAgICAvLyBEaWFsb2dzXG4gICAgZGlzcGxheUdlbmRlckRpYWxvZyhfc3RhdHVzKSB7XG4gICAgICAgIGlmKF9zdGF0dXMgPT0gZmFsc2UpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyA+PiBhY3Rpb24tZGlhbG9nLWNvZGVcbiAgICAgICAgbGV0IGdlbmRlckFjdGlvbnMgPSBbXTtcblxuICAgICAgICBmb3IgKHZhciB2IGluIHRoaXMuZ2VuZGVycykge1xuICAgICAgICAgICAgZ2VuZGVyQWN0aW9ucy5wdXNoKHRoaXMuZ2VuZGVyc1t2XS52YWx1ZSk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHRpdGxlOiBcIkdlbmRlciBzZWxlY3Rpb25cIixcbiAgICAgICAgICAgIG1lc3NhZ2U6IFwiQ2hvb3NlIHlvdXIgZ2VuZGVyXCIsXG4gICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBcIkNhbmNlbFwiLFxuICAgICAgICAgICAgYWN0aW9uczogZ2VuZGVyQWN0aW9uc1xuICAgICAgICB9O1xuXG4gICAgICAgIGFjdGlvbihvcHRpb25zKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGlmKHJlc3VsdCAhPSAnQ2FuY2VsJykge1xuICAgICAgICAgICAgICAgIGxldCBfZ2VuZGVyX2lkO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIHYgaW4gdGhpcy5nZW5kZXJzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuZ2VuZGVyc1t2XS52YWx1ZSA9PSByZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9nZW5kZXJfaWQgPSB2O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuZ2VuZGVyU2VsZWN0ZWQgPSB0aGlzLmdlbmRlcnNbX2dlbmRlcl9pZF0udmFsdWU7XG4gICAgICAgICAgICAgICAgdGhpcy51c2VyLmdlbmRlciA9IHRoaXMuZ2VuZGVyc1tfZ2VuZGVyX2lkXS5rZXk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAvLyA8PCBhY3Rpb24tZGlhbG9nLWNvZGVcbiAgICB9XG4gICAgZGlzcGxheUNvdW50cnlEaWFsb2coX3N0YXR1cykge1xuICAgICAgICAvLyA+PiBhY3Rpb24tZGlhbG9nLWNvZGVcbiAgICAgICAgY29uc29sZS5sb2coX3N0YXR1cyk7XG4gICAgICAgIGlmKF9zdGF0dXMgPT0gZmFsc2UpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBjb3VudHJ5QWN0aW9ucyA9IFtdO1xuXG4gICAgICAgIGZvciAodmFyIHYgaW4gdGhpcy5jb3VudHJpZXMpIHtcbiAgICAgICAgICAgIGNvdW50cnlBY3Rpb25zLnB1c2godGhpcy5jb3VudHJpZXNbdl0ubmFtZSk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHRpdGxlOiBcIkNvdW50cnkgc2VsZWN0aW9uXCIsXG4gICAgICAgICAgICBtZXNzYWdlOiBcIkNob29zZSB5b3VyIGNvdW50cnlcIixcbiAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgICAgICAgICBhY3Rpb25zOiBjb3VudHJ5QWN0aW9uc1xuICAgICAgICB9O1xuXG4gICAgICAgIGFjdGlvbihvcHRpb25zKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGlmKHJlc3VsdCAhPSAnQ2FuY2VsJykge1xuICAgICAgICAgICAgICAgIGxldCBfY291bnRyeV9pZDtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciB2IGluIHRoaXMuY291bnRyaWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuY291bnRyaWVzW3ZdLm5hbWUgPT0gcmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfY291bnRyeV9pZCA9IHY7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5jb3VudHJ5U2VsZWN0ZWQgPSB0aGlzLmNvdW50cmllc1tfY291bnRyeV9pZF0ubmFtZTtcbiAgICAgICAgICAgICAgICB0aGlzLnVzZXIuY291bnRyeSA9IHRoaXMuY291bnRyaWVzW19jb3VudHJ5X2lkXS5pZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIDw8IGFjdGlvbi1kaWFsb2ctY29kZVxuICAgIH1cblxuICAgIHB1YmxpYyBzZWxlY3RlZEluZGV4Q2hhbmdlZChhcmdzKSB7XG4gICAgICAgIGxldCBwaWNrZXIgPSA8TGlzdFBpY2tlcj5hcmdzLm9iamVjdDtcbiAgICAgICAgY29uc29sZS5sb2coXCJwaWNrZXIgc2VsZWN0aW9uOiBcIiArIHBpY2tlci5zZWxlY3RlZEluZGV4KTtcbiAgICB9XG5cbiAgICBnZXRHZW5kZXJUZXh0KG5hbWUpIHtcbiAgICAgICAgZm9yICh2YXIgdiBpbiB0aGlzLmdlbmRlcnMpIHtcbiAgICAgICAgICAgIGlmKHRoaXMuZ2VuZGVyc1t2XS5rZXkgPT0gbmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdlbmRlcnNbdl0udmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICdOdWxsJztcbiAgICB9XG4gICAgZ2V0Q291bnRyeVRleHQobmFtZSkge1xuICAgICAgICBmb3IgKHZhciB2IGluIHRoaXMuY291bnRyaWVzKSB7XG4gICAgICAgICAgICBpZih0aGlzLmNvdW50cmllc1t2XS5pZCA9PSBuYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY291bnRyaWVzW3ZdLm5hbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICdOdWxsJztcbiAgICB9XG4gICAgZWRpdEZvcm0oKSB7XG4gICAgICAgIHRoaXMuZWRpdFVzZXJGb3JtID0gIXRoaXMuZWRpdFVzZXJGb3JtO1xuICAgICAgICB0aGlzLnN0YXR1c0NoYW5nZS5lbWl0KHRoaXMuZWRpdFVzZXJGb3JtKTtcbiAgICAgICAgaWYoIXRoaXMuZWRpdFVzZXJGb3JtKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnSGVyZSBpcyBtZScpO1xuICAgICAgICAgICAgLy8gUmVzZXQgaW50ZXJmYWNlXG4gICAgICAgICAgICB0aGlzLnVzZXIubmFtZSA9IHRoaXMudXNlcl9kZWZhdWx0Lm5hbWU7XG4gICAgICAgICAgICB0aGlzLnVzZXIuZW1haWwgPSB0aGlzLnVzZXJfZGVmYXVsdC5lbWFpbDtcbiAgICAgICAgICAgIHRoaXMudXNlci5jcmVhdGVkX2F0ID0gdGhpcy51c2VyX2RlZmF1bHQuY3JlYXRlZF9hdDtcbiAgICAgICAgICAgIHRoaXMudXNlci5nZW5kZXIgPSB0aGlzLnVzZXJfZGVmYXVsdC5nZW5kZXI7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLnVzZXIudGl0bGUgKyAnID0gJyArIHRoaXMudXNlcl9kZWZhdWx0LnRpdGxlKTtcbiAgICAgICAgICAgIHRoaXMudXNlci50aXRsZSA9IHRoaXMudXNlcl9kZWZhdWx0LnRpdGxlO1xuICAgICAgICAgICAgdGhpcy51c2VyLmFib3V0ID0gdGhpcy51c2VyX2RlZmF1bHQuYWJvdXQ7XG4gICAgICAgICAgICB0aGlzLnVzZXIuY291bnRyeSA9IHRoaXMudXNlcl9kZWZhdWx0LmNvdW50cnk7XG4gICAgICAgICAgICAvLyBGaWxsIHZhbHVlc1xuICAgICAgICAgICAgdGhpcy5nZW5kZXJTZWxlY3RlZCA9IHRoaXMuZ2V0R2VuZGVyVGV4dCh0aGlzLnVzZXIuZ2VuZGVyKTtcbiAgICAgICAgICAgIHRoaXMuY291bnRyeVNlbGVjdGVkID0gdGhpcy5nZXRDb3VudHJ5VGV4dCh0aGlzLnVzZXIuY291bnRyeSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3VibWl0ICh2YWx1ZSA6IHByb2ZpbGVGb3JtKSB7XG4gICAgICAgIHRoaXMuZWRpdFVzZXJGb3JtID0gZmFsc2U7XG4gICAgICAgIHRoaXMubG9hZERhdGEgPSB0cnVlO1xuICAgICAgICB0aGlzLmF1dGhlbnRpY2F0aW9uU2VydmljZS5jaGFuZ2VQcm9maWxlSW5mbyh2YWx1ZSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHJlc3BvbnNlIDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYocmVzcG9uc2Uuc3VjY2VzcyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkRGF0YSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0dXNDaGFuZ2UuZW1pdChmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFsZXJ0KCdDaGFuZ2VzIHdhcyBTYXZlZCcpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWxlcnQocmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQoKEpTT04ucGFyc2UoZXJyb3IudGV4dCgpKSkubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yLnRleHQoKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgfVxuICAgIGFsZXJ0KG1lc3NhZ2U6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gYWxlcnQoe1xuICAgICAgICAgICAgdGl0bGU6IFwiUHJvZmlsZVwiLFxuICAgICAgICAgICAgb2tCdXR0b25UZXh0OiBcIk9LXCIsXG4gICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlXG4gICAgICAgIH0pO1xuICAgIH1cbn0iXX0=
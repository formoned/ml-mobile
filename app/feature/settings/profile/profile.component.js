"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var dialogs_1 = require("tns-core-modules/ui/dialogs");
var services_1 = require("../../../core/services");
var ProfileComponent = /** @class */ (function () {
    function ProfileComponent(authenticationService, apiGetService) {
        this.authenticationService = authenticationService;
        this.apiGetService = apiGetService;
        this.loadData = false;
        this.isSubmiting = false;
        this.countries = [];
        this.genders = [];
        this.genderSelected = 'None';
        this.countrySelected = 'None';
        this.statusChange = new core_1.EventEmitter();
        this.test = 'Waiting!';
        this.editUserForm = false;
        this.user = {
            name: '',
            email: '',
            created_at: '',
            title: '',
            about: '',
            gender: 'other',
            country: null
        };
        this.user_default = {
            name: '',
            email: '',
            created_at: '',
            title: '',
            about: '',
            gender: 'other',
            country: null
        };
        // Use the constructor to inject services.
        this.genders.push({ key: 'man', value: 'Man' }, { key: 'woman', value: 'Woman' }, { key: 'other', value: 'Other' });
        console.log('profile construct');
    }
    ProfileComponent.prototype.ngOnInit = function () {
        // Use the "ngOnInit" handler to initialize data for the view.
        this.loadUser();
    };
    ProfileComponent.prototype.onSave = function () {
        this.test = 'ITs save';
        this.submit(this.user);
    };
    ProfileComponent.prototype.onEdit = function () {
        this.test = 'ITs edit';
        this.editForm();
    };
    ProfileComponent.prototype.onCancel = function () {
        this.editForm();
    };
    // Load data
    ProfileComponent.prototype.loadUser = function () {
        var _this = this;
        this.loadData = true;
        this.authenticationService.getUser()
            .subscribe(function (response) {
            _this.user.name = response.name;
            _this.user.email = response.email;
            _this.user.created_at = response.created_at;
            _this.user.gender = response.gender;
            _this.user.title = response.title;
            _this.user.about = response.about;
            _this.user.country = response.country_id;
            _this.user_default.name = response.name;
            _this.user_default.email = response.email;
            _this.user_default.created_at = response.created_at;
            _this.user_default.gender = response.gender;
            _this.user_default.title = response.title;
            _this.user_default.about = response.about;
            _this.user_default.country = response.country_id;
            // this.loadData = false;
            _this.loadCountries();
            //
            _this.genderSelected = _this.getGenderText(_this.user.gender);
        }, function (error) {
            dialogs_1.alert((JSON.parse(error.text())).message);
            console.log(error.text());
        });
    };
    ;
    ProfileComponent.prototype.loadCountries = function () {
        var _this = this;
        this.apiGetService.getCountriesList()
            .subscribe(function (response) {
            _this.countries = response.list;
            _this.countrySelected = _this.getCountryText(_this.user.country);
            _this.loadData = false;
        }, function (error) {
            dialogs_1.alert((JSON.parse(error.text())).message);
            console.log(error.text());
        });
    };
    // Focus elements
    ProfileComponent.prototype.focusTitle = function () {
        this.title.nativeElement.focus();
    };
    ProfileComponent.prototype.focusAbout = function () {
        this.about.nativeElement.focus();
    };
    // Dialogs
    ProfileComponent.prototype.displayGenderDialog = function (_status) {
        var _this = this;
        if (_status == false) {
            return;
        }
        // >> action-dialog-code
        var genderActions = [];
        for (var v in this.genders) {
            genderActions.push(this.genders[v].value);
        }
        var options = {
            title: "Gender selection",
            message: "Choose your gender",
            cancelButtonText: "Cancel",
            actions: genderActions
        };
        dialogs_1.action(options).then(function (result) {
            if (result != 'Cancel') {
                var _gender_id = void 0;
                for (var v in _this.genders) {
                    if (_this.genders[v].value == result) {
                        _gender_id = v;
                    }
                }
                _this.genderSelected = _this.genders[_gender_id].value;
                _this.user.gender = _this.genders[_gender_id].key;
            }
        });
        // << action-dialog-code
    };
    ProfileComponent.prototype.displayCountryDialog = function (_status) {
        var _this = this;
        // >> action-dialog-code
        if (_status == false) {
            return;
        }
        var countryActions = [];
        for (var v in this.countries) {
            countryActions.push(this.countries[v].name);
        }
        var options = {
            title: "Country selection",
            message: "Choose your country",
            cancelButtonText: "Cancel",
            actions: countryActions
        };
        dialogs_1.action(options).then(function (result) {
            if (result != 'Cancel') {
                var _country_id = void 0;
                for (var v in _this.countries) {
                    if (_this.countries[v].name == result) {
                        _country_id = v;
                    }
                }
                _this.countrySelected = _this.countries[_country_id].name;
                _this.user.country = _this.countries[_country_id].id;
            }
        });
        // << action-dialog-code
    };
    ProfileComponent.prototype.selectedIndexChanged = function (args) {
        var picker = args.object;
        console.log("picker selection: " + picker.selectedIndex);
    };
    ProfileComponent.prototype.getGenderText = function (name) {
        for (var v in this.genders) {
            if (this.genders[v].key == name) {
                return this.genders[v].value;
            }
        }
        return 'Null';
    };
    ProfileComponent.prototype.getCountryText = function (name) {
        for (var v in this.countries) {
            if (this.countries[v].id == name) {
                return this.countries[v].name;
            }
        }
        return 'Null';
    };
    ProfileComponent.prototype.editForm = function () {
        this.editUserForm = !this.editUserForm;
        this.statusChange.emit(this.editUserForm);
        if (!this.editUserForm) {
            console.log('Here is me');
            // Reset interface
            this.user.name = this.user_default.name;
            this.user.email = this.user_default.email;
            this.user.created_at = this.user_default.created_at;
            this.user.gender = this.user_default.gender;
            console.log(this.user.title + ' = ' + this.user_default.title);
            this.user.title = this.user_default.title;
            this.user.about = this.user_default.about;
            this.user.country = this.user_default.country;
            // Fill values
            this.genderSelected = this.getGenderText(this.user.gender);
            this.countrySelected = this.getCountryText(this.user.country);
        }
    };
    ProfileComponent.prototype.submit = function (value) {
        var _this = this;
        this.editUserForm = false;
        this.loadData = true;
        this.authenticationService.changeProfileInfo(value)
            .subscribe(function (response) {
            if (response.success === true) {
                _this.loadData = false;
                _this.statusChange.emit(false);
                _this.alert('Changes was Saved');
            }
            else {
                // false
                _this.alert(response.message);
            }
        }, function (error) {
            dialogs_1.alert((JSON.parse(error.text())).message);
            console.log(error.text());
        });
    };
    ProfileComponent.prototype.alert = function (message) {
        return dialogs_1.alert({
            title: "Profile",
            okButtonText: "OK",
            message: message
        });
    };
    __decorate([
        core_1.Output(),
        __metadata("design:type", Object)
    ], ProfileComponent.prototype, "statusChange", void 0);
    __decorate([
        core_1.ViewChild("title"),
        __metadata("design:type", core_1.ElementRef)
    ], ProfileComponent.prototype, "title", void 0);
    __decorate([
        core_1.ViewChild("about"),
        __metadata("design:type", core_1.ElementRef)
    ], ProfileComponent.prototype, "about", void 0);
    ProfileComponent = __decorate([
        core_1.Component({
            selector: "Profile",
            moduleId: module.id,
            templateUrl: "./profile.component.html"
        }),
        __metadata("design:paramtypes", [services_1.AuthenticationService,
            services_1.ApiGetService])
    ], ProfileComponent);
    return ProfileComponent;
}());
exports.ProfileComponent = ProfileComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZmlsZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJwcm9maWxlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNDQUFvRztBQUVwRyx1REFBMEQ7QUFDMUQsbURBQTRFO0FBYzVFO0lBa0NJLDBCQUNZLHFCQUE2QyxFQUM3QyxhQUE2QjtRQUQ3QiwwQkFBcUIsR0FBckIscUJBQXFCLENBQXdCO1FBQzdDLGtCQUFhLEdBQWIsYUFBYSxDQUFnQjtRQWxDekMsYUFBUSxHQUFhLEtBQUssQ0FBQztRQUMzQixnQkFBVyxHQUFhLEtBQUssQ0FBQztRQUM5QixjQUFTLEdBQWlCLEVBQUUsQ0FBQztRQUM3QixZQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2IsbUJBQWMsR0FBVyxNQUFNLENBQUM7UUFDaEMsb0JBQWUsR0FBVyxNQUFNLENBQUM7UUFDdkIsaUJBQVksR0FBRyxJQUFJLG1CQUFZLEVBQVcsQ0FBQztRQUlyRCxTQUFJLEdBQUcsVUFBVSxDQUFDO1FBRWxCLGlCQUFZLEdBQWEsS0FBSyxDQUFDO1FBQy9CLFNBQUksR0FBaUI7WUFDakIsSUFBSSxFQUFHLEVBQUU7WUFDVCxLQUFLLEVBQUcsRUFBRTtZQUNWLFVBQVUsRUFBRyxFQUFFO1lBQ2YsS0FBSyxFQUFHLEVBQUU7WUFDVixLQUFLLEVBQUcsRUFBRTtZQUNWLE1BQU0sRUFBRyxPQUFPO1lBQ2hCLE9BQU8sRUFBRyxJQUFJO1NBQ2pCLENBQUM7UUFDRixpQkFBWSxHQUFpQjtZQUN6QixJQUFJLEVBQUcsRUFBRTtZQUNULEtBQUssRUFBRyxFQUFFO1lBQ1YsVUFBVSxFQUFHLEVBQUU7WUFDZixLQUFLLEVBQUcsRUFBRTtZQUNWLEtBQUssRUFBRyxFQUFFO1lBQ1YsTUFBTSxFQUFHLE9BQU87WUFDaEIsT0FBTyxFQUFHLElBQUk7U0FDakIsQ0FBQztRQU1FLDBDQUEwQztRQUMxQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FDYixFQUFDLEdB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Z0NBQXFCO1lBQzdCLHdCQUFhO09BcENoQyxnQkFBZ0IsQ0E4UDVCO0lBQUQsdUJBQUM7Q0FBQSxBQTlQRCxJQThQQztBQTlQWSw0Q0FBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25Jbml0LCBPdXRwdXQsIFZpZXdDaGlsZH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7TGlzdFBpY2tlcn0gZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdWkvbGlzdC1waWNrZXJcIjtcbmltcG9ydCB7YWN0aW9uLCBhbGVydH0gZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdWkvZGlhbG9nc1wiO1xuaW1wb3J0IHtBcGlHZXRTZXJ2aWNlLCBBdXRoZW50aWNhdGlvblNlcnZpY2V9IGZyb20gXCIuLi8uLi8uLi9jb3JlL3NlcnZpY2VzXCI7XG5pbXBvcnQge3Byb2ZpbGVGb3JtfSBmcm9tIFwiLi4vLi4vLi4vY29yZS9tb2RlbHNcIjtcblxuXG5leHBvcnQgaW50ZXJmYWNlIGNvdW50cmllcyB7XG4gICAgaWQgOiBudW1iZXI7XG4gICAgbmFtZSA6IHN0cmluZztcbn1cblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6IFwiUHJvZmlsZVwiLFxuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgdGVtcGxhdGVVcmw6IFwiLi9wcm9maWxlLmNvbXBvbmVudC5odG1sXCJcbn0pXG5leHBvcnQgY2xhc3MgUHJvZmlsZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgICBsb2FkRGF0YSA6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBpc1N1Ym1pdGluZyA6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBjb3VudHJpZXMgOiBjb3VudHJpZXNbXSA9IFtdO1xuICAgIGdlbmRlcnMgPSBbXTtcbiAgICBnZW5kZXJTZWxlY3RlZDogc3RyaW5nID0gJ05vbmUnO1xuICAgIGNvdW50cnlTZWxlY3RlZDogc3RyaW5nID0gJ05vbmUnO1xuICAgIEBPdXRwdXQoKSBzdGF0dXNDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XG4gICAgQFZpZXdDaGlsZChcInRpdGxlXCIpIHRpdGxlOiBFbGVtZW50UmVmO1xuICAgIEBWaWV3Q2hpbGQoXCJhYm91dFwiKSBhYm91dDogRWxlbWVudFJlZjtcblxuICAgIHRlc3QgPSAnV2FpdGluZyEnO1xuXG4gICAgZWRpdFVzZXJGb3JtIDogYm9vbGVhbiA9IGZhbHNlO1xuICAgIHVzZXIgOiBwcm9maWxlRm9ybSA9IHtcbiAgICAgICAgbmFtZSA6ICcnLFxuICAgICAgICBlbWFpbCA6ICcnLFxuICAgICAgICBjcmVhdGVkX2F0IDogJycsXG4gICAgICAgIHRpdGxlIDogJycsXG4gICAgICAgIGFib3V0IDogJycsXG4gICAgICAgIGdlbmRlciA6ICdvdGhlcicsXG4gICAgICAgIGNvdW50cnkgOiBudWxsXG4gICAgfTtcbiAgICB1c2VyX2RlZmF1bHQgOiBwcm9maWxlRm9ybSA9IHtcbiAgICAgICAgbmFtZSA6ICcnLFxuICAgICAgICBlbWFpbCA6ICcnLFxuICAgICAgICBjcmVhdGVkX2F0IDogJycsXG4gICAgICAgIHRpdGxlIDogJycsXG4gICAgICAgIGFib3V0IDogJycsXG4gICAgICAgIGdlbmRlciA6ICdvdGhlcicsXG4gICAgICAgIGNvdW50cnkgOiBudWxsXG4gICAgfTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIGF1dGhlbnRpY2F0aW9uU2VydmljZSA6IEF1dGhlbnRpY2F0aW9uU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBhcGlHZXRTZXJ2aWNlIDogQXBpR2V0U2VydmljZVxuICAgICkge1xuICAgICAgICAvLyBVc2UgdGhlIGNvbnN0cnVjdG9yIHRvIGluamVjdCBzZXJ2aWNlcy5cbiAgICAgICAgdGhpcy5nZW5kZXJzLnB1c2goXG4gICAgICAgICAgICB7a2V5IDogJ21hbicsIHZhbHVlIDogJ01hbid9LFxuICAgICAgICAgICAge2tleSA6ICd3b21hbicsIHZhbHVlIDogJ1dvbWFuJ30sXG4gICAgICAgICAgICB7a2V5IDogJ290aGVyJywgdmFsdWUgOiAnT3RoZXInfVxuICAgICAgICApO1xuICAgICAgICBjb25zb2xlLmxvZygncHJvZmlsZSBjb25zdHJ1Y3QnKTtcbiAgICB9XG5cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICAvLyBVc2UgdGhlIFwibmdPbkluaXRcIiBoYW5kbGVyIHRvIGluaXRpYWxpemUgZGF0YSBmb3IgdGhlIHZpZXcuXG4gICAgICAgIHRoaXMubG9hZFVzZXIoKTtcbiAgICB9XG5cbiAgICBvblNhdmUoKXtcbiAgICAgICAgdGhpcy50ZXN0ID0gJ0lUcyBzYXZlJztcblxuICAgICAgICB0aGlzLnN1Ym1pdCh0aGlzLnVzZXIpO1xuICAgIH1cbiAgICBvbkVkaXQoKSB7XG4gICAgICAgIHRoaXMudGVzdCA9ICdJVHMgZWRpdCc7XG4gICAgICAgIHRoaXMuZWRpdEZvcm0oKTtcbiAgICB9XG4gICAgb25DYW5jZWwoKSB7XG4gICAgICAgIHRoaXMuZWRpdEZvcm0oKTtcbiAgICB9XG5cbiAgICAvLyBMb2FkIGRhdGFcbiAgICBsb2FkVXNlcigpIHtcbiAgICAgICAgdGhpcy5sb2FkRGF0YSA9IHRydWU7XG4gICAgICAgIHRoaXMuYXV0aGVudGljYXRpb25TZXJ2aWNlLmdldFVzZXIoKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgocmVzcG9uc2UgOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VyLm5hbWUgPSByZXNwb25zZS5uYW1lO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXIuZW1haWwgPSByZXNwb25zZS5lbWFpbDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VyLmNyZWF0ZWRfYXQgPSByZXNwb25zZS5jcmVhdGVkX2F0O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXIuZ2VuZGVyID0gcmVzcG9uc2UuZ2VuZGVyO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXIudGl0bGUgPSByZXNwb25zZS50aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VyLmFib3V0ID0gcmVzcG9uc2UuYWJvdXQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXNlci5jb3VudHJ5ID0gcmVzcG9uc2UuY291bnRyeV9pZDtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXJfZGVmYXVsdC5uYW1lID0gcmVzcG9uc2UubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VyX2RlZmF1bHQuZW1haWwgPSByZXNwb25zZS5lbWFpbDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VyX2RlZmF1bHQuY3JlYXRlZF9hdCA9IHJlc3BvbnNlLmNyZWF0ZWRfYXQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXNlcl9kZWZhdWx0LmdlbmRlciA9IHJlc3BvbnNlLmdlbmRlcjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VyX2RlZmF1bHQudGl0bGUgPSByZXNwb25zZS50aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VyX2RlZmF1bHQuYWJvdXQgPSByZXNwb25zZS5hYm91dDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VyX2RlZmF1bHQuY291bnRyeSA9IHJlc3BvbnNlLmNvdW50cnlfaWQ7XG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMubG9hZERhdGEgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkQ291bnRyaWVzKCk7XG4gICAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZGVyU2VsZWN0ZWQgPSB0aGlzLmdldEdlbmRlclRleHQodGhpcy51c2VyLmdlbmRlcik7XG5cblxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgICAgICBhbGVydCgoSlNPTi5wYXJzZShlcnJvci50ZXh0KCkpKS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IudGV4dCgpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICB9O1xuICAgIGxvYWRDb3VudHJpZXMoKSB7XG4gICAgICAgIHRoaXMuYXBpR2V0U2VydmljZS5nZXRDb3VudHJpZXNMaXN0KClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHJlc3BvbnNlIDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb3VudHJpZXMgPSByZXNwb25zZS5saXN0O1xuICAgICAgICAgICAgICAgIHRoaXMuY291bnRyeVNlbGVjdGVkID0gdGhpcy5nZXRDb3VudHJ5VGV4dCh0aGlzLnVzZXIuY291bnRyeSk7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkRGF0YSA9IGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICBhbGVydCgoSlNPTi5wYXJzZShlcnJvci50ZXh0KCkpKS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvci50ZXh0KCkpO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gRm9jdXMgZWxlbWVudHNcbiAgICBmb2N1c1RpdGxlKCkge1xuICAgICAgICB0aGlzLnRpdGxlLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICB9XG4gICAgZm9jdXNBYm91dCgpIHtcbiAgICAgICAgdGhpcy5hYm91dC5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG4gICAgfVxuXG4gICAgLy8gRGlhbG9nc1xuICAgIGRpc3BsYXlHZW5kZXJEaWFsb2coX3N0YXR1cykge1xuICAgICAgICBpZihfc3RhdHVzID09IGZhbHNlKVxuICAgICAgICB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gPj4gYWN0aW9uLWRpYWxvZy1jb2RlXG4gICAgICAgIGxldCBnZW5kZXJBY3Rpb25zID0gW107XG5cbiAgICAgICAgZm9yICh2YXIgdiBpbiB0aGlzLmdlbmRlcnMpIHtcbiAgICAgICAgICAgIGdlbmRlckFjdGlvbnMucHVzaCh0aGlzLmdlbmRlcnNbdl0udmFsdWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICB0aXRsZTogXCJHZW5kZXIgc2VsZWN0aW9uXCIsXG4gICAgICAgICAgICBtZXNzYWdlOiBcIkNob29zZSB5b3VyIGdlbmRlclwiLFxuICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogXCJDYW5jZWxcIixcbiAgICAgICAgICAgIGFjdGlvbnM6IGdlbmRlckFjdGlvbnNcbiAgICAgICAgfTtcblxuICAgICAgICBhY3Rpb24ob3B0aW9ucykudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICBpZihyZXN1bHQgIT0gJ0NhbmNlbCcpIHtcbiAgICAgICAgICAgICAgICBsZXQgX2dlbmRlcl9pZDtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciB2IGluIHRoaXMuZ2VuZGVycykge1xuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLmdlbmRlcnNbdl0udmFsdWUgPT0gcmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfZ2VuZGVyX2lkID0gdjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmdlbmRlclNlbGVjdGVkID0gdGhpcy5nZW5kZXJzW19nZW5kZXJfaWRdLnZhbHVlO1xuICAgICAgICAgICAgICAgIHRoaXMudXNlci5nZW5kZXIgPSB0aGlzLmdlbmRlcnNbX2dlbmRlcl9pZF0ua2V5O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gPDwgYWN0aW9uLWRpYWxvZy1jb2RlXG4gICAgfVxuICAgIGRpc3BsYXlDb3VudHJ5RGlhbG9nKF9zdGF0dXMpIHtcbiAgICAgICAgLy8gPj4gYWN0aW9uLWRpYWxvZy1jb2RlXG4gICAgICAgIGlmKF9zdGF0dXMgPT0gZmFsc2UpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBjb3VudHJ5QWN0aW9ucyA9IFtdO1xuXG4gICAgICAgIGZvciAodmFyIHYgaW4gdGhpcy5jb3VudHJpZXMpIHtcbiAgICAgICAgICAgIGNvdW50cnlBY3Rpb25zLnB1c2godGhpcy5jb3VudHJpZXNbdl0ubmFtZSk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHRpdGxlOiBcIkNvdW50cnkgc2VsZWN0aW9uXCIsXG4gICAgICAgICAgICBtZXNzYWdlOiBcIkNob29zZSB5b3VyIGNvdW50cnlcIixcbiAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgICAgICAgICBhY3Rpb25zOiBjb3VudHJ5QWN0aW9uc1xuICAgICAgICB9O1xuXG4gICAgICAgIGFjdGlvbihvcHRpb25zKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGlmKHJlc3VsdCAhPSAnQ2FuY2VsJykge1xuICAgICAgICAgICAgICAgIGxldCBfY291bnRyeV9pZDtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciB2IGluIHRoaXMuY291bnRyaWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuY291bnRyaWVzW3ZdLm5hbWUgPT0gcmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfY291bnRyeV9pZCA9IHY7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5jb3VudHJ5U2VsZWN0ZWQgPSB0aGlzLmNvdW50cmllc1tfY291bnRyeV9pZF0ubmFtZTtcbiAgICAgICAgICAgICAgICB0aGlzLnVzZXIuY291bnRyeSA9IHRoaXMuY291bnRyaWVzW19jb3VudHJ5X2lkXS5pZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIDw8IGFjdGlvbi1kaWFsb2ctY29kZVxuICAgIH1cblxuICAgIHB1YmxpYyBzZWxlY3RlZEluZGV4Q2hhbmdlZChhcmdzKSB7XG4gICAgICAgIGxldCBwaWNrZXIgPSA8TGlzdFBpY2tlcj5hcmdzLm9iamVjdDtcbiAgICAgICAgY29uc29sZS5sb2coXCJwaWNrZXIgc2VsZWN0aW9uOiBcIiArIHBpY2tlci5zZWxlY3RlZEluZGV4KTtcbiAgICB9XG5cbiAgICBnZXRHZW5kZXJUZXh0KG5hbWUpIHtcbiAgICAgICAgZm9yICh2YXIgdiBpbiB0aGlzLmdlbmRlcnMpIHtcbiAgICAgICAgICAgIGlmKHRoaXMuZ2VuZGVyc1t2XS5rZXkgPT0gbmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdlbmRlcnNbdl0udmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICdOdWxsJztcbiAgICB9XG4gICAgZ2V0Q291bnRyeVRleHQobmFtZSkge1xuICAgICAgICBmb3IgKHZhciB2IGluIHRoaXMuY291bnRyaWVzKSB7XG4gICAgICAgICAgICBpZih0aGlzLmNvdW50cmllc1t2XS5pZCA9PSBuYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY291bnRyaWVzW3ZdLm5hbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICdOdWxsJztcbiAgICB9XG4gICAgZWRpdEZvcm0oKSB7XG4gICAgICAgIHRoaXMuZWRpdFVzZXJGb3JtID0gIXRoaXMuZWRpdFVzZXJGb3JtO1xuICAgICAgICB0aGlzLnN0YXR1c0NoYW5nZS5lbWl0KHRoaXMuZWRpdFVzZXJGb3JtKTtcbiAgICAgICAgaWYoIXRoaXMuZWRpdFVzZXJGb3JtKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnSGVyZSBpcyBtZScpO1xuICAgICAgICAgICAgLy8gUmVzZXQgaW50ZXJmYWNlXG4gICAgICAgICAgICB0aGlzLnVzZXIubmFtZSA9IHRoaXMudXNlcl9kZWZhdWx0Lm5hbWU7XG4gICAgICAgICAgICB0aGlzLnVzZXIuZW1haWwgPSB0aGlzLnVzZXJfZGVmYXVsdC5lbWFpbDtcbiAgICAgICAgICAgIHRoaXMudXNlci5jcmVhdGVkX2F0ID0gdGhpcy51c2VyX2RlZmF1bHQuY3JlYXRlZF9hdDtcbiAgICAgICAgICAgIHRoaXMudXNlci5nZW5kZXIgPSB0aGlzLnVzZXJfZGVmYXVsdC5nZW5kZXI7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLnVzZXIudGl0bGUgKyAnID0gJyArIHRoaXMudXNlcl9kZWZhdWx0LnRpdGxlKTtcbiAgICAgICAgICAgIHRoaXMudXNlci50aXRsZSA9IHRoaXMudXNlcl9kZWZhdWx0LnRpdGxlO1xuICAgICAgICAgICAgdGhpcy51c2VyLmFib3V0ID0gdGhpcy51c2VyX2RlZmF1bHQuYWJvdXQ7XG4gICAgICAgICAgICB0aGlzLnVzZXIuY291bnRyeSA9IHRoaXMudXNlcl9kZWZhdWx0LmNvdW50cnk7XG4gICAgICAgICAgICAvLyBGaWxsIHZhbHVlc1xuICAgICAgICAgICAgdGhpcy5nZW5kZXJTZWxlY3RlZCA9IHRoaXMuZ2V0R2VuZGVyVGV4dCh0aGlzLnVzZXIuZ2VuZGVyKTtcbiAgICAgICAgICAgIHRoaXMuY291bnRyeVNlbGVjdGVkID0gdGhpcy5nZXRDb3VudHJ5VGV4dCh0aGlzLnVzZXIuY291bnRyeSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3VibWl0ICh2YWx1ZSA6IHByb2ZpbGVGb3JtKSB7XG4gICAgICAgIHRoaXMuZWRpdFVzZXJGb3JtID0gZmFsc2U7XG4gICAgICAgIHRoaXMubG9hZERhdGEgPSB0cnVlO1xuICAgICAgICB0aGlzLmF1dGhlbnRpY2F0aW9uU2VydmljZS5jaGFuZ2VQcm9maWxlSW5mbyh2YWx1ZSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHJlc3BvbnNlIDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYocmVzcG9uc2Uuc3VjY2VzcyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkRGF0YSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0dXNDaGFuZ2UuZW1pdChmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFsZXJ0KCdDaGFuZ2VzIHdhcyBTYXZlZCcpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWxlcnQocmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQoKEpTT04ucGFyc2UoZXJyb3IudGV4dCgpKSkubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yLnRleHQoKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgfVxuICAgIGFsZXJ0KG1lc3NhZ2U6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gYWxlcnQoe1xuICAgICAgICAgICAgdGl0bGU6IFwiUHJvZmlsZVwiLFxuICAgICAgICAgICAgb2tCdXR0b25UZXh0OiBcIk9LXCIsXG4gICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlXG4gICAgICAgIH0pO1xuICAgIH1cbn0iXX0=